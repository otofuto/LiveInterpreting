<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="description" content="">
		<meta name="keywords" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="robots" content="noindex,nofollow">
		<title>{{.Account.Name}}さん | LiveInterpreting</title>
		<link rel="stylesheet" href="/st/css/master.css">
		<style>
			#content {
				width: 80%;
				margin: 0 auto;
				text-align: center;
				font-family: 'M PLUS Rounded 1c', sans-serif;
			}

			#accountinfo {
				font-family: 'M PLUS Rounded 1c', sans-serif;
				display: flex;
				flex-wrap: wrap;
				text-align: left;
				border-bottom: solid 2px gray;
			}

			pre {
				font-family: 'M PLUS Rounded 1c', sans-serif;
			}

			@media screen and (max-width: 812px) {
				#content {
					width: 100%;
				}
			}

			#iconDisp {
				position: relative;
				display: inline-block;
				width: 110px;
				height: 110px;
				margin-right: 20px;
				vertical-align: top;
				border-radius: 5px;
				background-size: cover;
				background-position: center;
				background-color: lightgray;
				background-image: url('/Account/img/{{.Account.Id}}');
			}
		</style>
	</head>
	<body>
		<header class="page-header">
			<div class="service-title">Live Interpreting</div>
		</header>
		<main>
			<div id="content">
				<header id="accountinfo">
					<div id="iconDisp"></div>
					<div style="width: calc(100% - 130px);">
						<div style="font-size: 120%; font-weight: bold;">{{.Account.Name}}</div>
						<span>{{ if eq .Account.Sex 0 }}男性{{ else if eq .Account.Sex 1 }}女性{{ else }}その他{{ end }}</span><br>
						<span>{{ if eq .Account.UserType "influencer" }}配信者{{ else }}通訳者{{end}}</span><br>
						<span>{{.Account.CreatedAt}}に登録</span>
					</div>
					<div style="width: 100%;"><pre>{{.Account.Description}}</pre></div>
					{{ if ne (len .Account.Langs) 0 }}
						<p>使用出来る言語: </p>
						<p>
						{{ range .Account.Langs }}
						{{ .Lang }}<br>
						{{ end }}
					</p>{{ end }}
					<div style="width: 100%; text-align: right;">
						{{ if and (ne .Login.Id .Account.Id) (.IsFollower) }}
						<span>フォローされています</span>
						{{ end }}
						{{ if eq .Login.Id .Account.Id }}
						<button class="button" onclick="location = '/edit/';">アカウント情報を編集する</button>
						{{ else if ne .Login.Id -1 }}
							{{ if .IsFollow }}
						<button class="button" onclick="unfollow(this)" style="background-color: var(--color1); color: white;">✔フォロー中</button>
							{{ else }}
						<button class="button" onclick="follow(this)">フォロー</button>
							{{ end }}
						<button class="button">通報</button>
						{{ end }}
					</div>
				</header>
			</div>
		</main>
		<footer class="page-footer">
			<label>© 2020 Live InterPreting - Powered by OTFT</label>
		</footer>
		<script src="/st/js/master.js"></script>
		<script>
			function follow(btn) {
				var data = new FormData();
				data.append("target_id", "{{.Account.Id}}");
				data.append("action", "0");
				fetch('/AccountSocial/', {
					method: "post",
					body: data,
					credentials: "include"
				}).then(res => {
					if (res.status == 200)
						return res.json();
					else
						return false;
				}).then(result => {
					if (result) {
						btn.innerText = "✔フォロー中";
						btn.style.backgroundColor = "var(--color1)";
						btn.style.color = "white";
						btn.setAttribute("onclick", "unfollow(this)");
					} else {
						alert('フォローに失敗しました。');
					}
				});
			}

			function unfollow(btn) {
				var data = new FormData();
				data.append("target_id", "{{.Account.Id}}");
				fetch('/AccountSocial/', {
					method: "delete",
					body: data,
					credentials: "include"
				}).then(res => {
					if (res.status == 200)
						return res.json();
					else
						return false;
				}).then(result => {
					if (result) {
						btn.innerText = "フォロー";
						btn.removeAttribute("style");
						btn.setAttribute("onclick", "follow(this)");
					} else {
						alert('フォロー解除に失敗しました。');
					}
				});
			}
		</script>
	</body>
</html>